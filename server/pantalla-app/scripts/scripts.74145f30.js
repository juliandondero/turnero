"use strict";angular.module("zTurnosClienteApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","angular-growl","ngAudio","com.2fdevs.videogular","LocalStorageModule"]).config(["$routeProvider","localStorageServiceProvider","growlProvider",function(a,b,c){a.when("/index",{templateUrl:"views/index.html",controller:"IndexCtrl"}).when("/configuracion",{templateUrl:"views/configuracion.html",controller:"ConfiguracionCtrl"}).otherwise({redirectTo:"/index"}),b.setPrefix("zTurnos"),c.globalTimeToLive(5e3),c.globalEnableHtml(!0)}]).run(["$rootScope","ngAudio","$location","$sce","localStorageService",function(a,b,c,d,e){a.goTo=function(a){c.path(a)},a.perfilApp={showVideo:!0,intervalTime:500,alertIterations:10,fontSize:30,maxShowHistory:8,sound1:b.load("sounds/sound1.wav"),soundUrl:"sounds/sound1.wav",nameSpace:"pantalla",pantallaRef:"2",host:"http://dagur.zetti.com.ar",port:"3000",theme:"white",volumenVideo:.5,volumenAlerta:0,nombre_nodo:"YUNOW",tipo_puesto:1,puesto_venta:862830,videoWidth:70},a.ultima_cola_movida=void 0,a.colas={},a.history=[],a.refreshSources=function(){var b=e.get("$rootScope.videosSources");void 0!=b&&(a.videosSources=b,a.videosSources=_.map(a.videosSources,function(a){return a.sources=_.map(a.sources,function(a){return a.src=d.trustAsResourceUrl(a.srcUrl),a}),a}))},a.refreshSources(),a.savePerfilApp=function(){var b={showVideo:a.perfilApp.showVideo,intervalTime:a.perfilApp.intervalTime,alertIterations:a.perfilApp.alertIterations,fontSize:a.perfilApp.fontSize,maxShowHistory:a.perfilApp.maxShowHistory,soundUrl:a.perfilApp.soundUrl,nameSpace:a.perfilApp.nameSpace,pantallaRef:a.perfilApp.pantallaRef,host:a.perfilApp.host,port:a.perfilApp.port,theme:a.perfilApp.theme,volumenVideo:a.perfilApp.volumenVideo,volumenAlerta:a.perfilApp.volumenAlerta,nombre_nodo:a.perfilApp.nombre_nodo,tipo_puesto:a.perfilApp.tipo_puesto,puesto_venta:a.perfilApp.puesto_venta,videoWidth:a.perfilApp.videoWidth};e.set("$rootScope.perfilApp",b)},a.saveVideos=function(b){a.videosSources=b,e.set("$rootScope.videosSources",b)},a.loadVideos=function(){a.videosSources=e.get("$rootScope.videosSources"),a.videosSources=_.map(a.videosSources,function(a){return a.sources=_.map(a.sources,function(a){return a.src=d.trustAsResourceUrl(a.lan_source),a}),a})},a.configureSound=function(b){console.log("configurando volumen: "+b),a.perfilApp.sound1.volume=0==b?1e-9:parseFloat(b)},a.loadPerfilApp=function(){var c=e.get("$rootScope.perfilApp");void 0!=c&&(a.perfilApp=c,void 0!=a.perfilApp.soundUrl&&(a.perfilApp.sound1=b.load(a.perfilApp.soundUrl),console.log("configurando volumen campana: "+a.perfilApp.volumenAlerta),a.configureSound(a.perfilApp.volumenAlerta)))},a.loadPerfilApp(),a.loadVideos()}]),angular.module("zTurnosClienteApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("zTurnosClienteApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("zTurnosClienteApp").service("Socket",["$rootScope","growl",function(a,b){var c=function(){return a.perfilApp.host+":"+a.perfilApp.port+"/"+a.perfilApp.nameSpace+a.perfilApp.pantallaRef},d=c();console.log("Conectando a: "+d);var e=io.connect(d);return e.on("disconnect",function(a){b.addErrorMessage("Error en conexion... "+a)}),{on:function(b,c){e.on(b,function(){var b=arguments;a.$apply(function(){c.apply(e,b)})})},emit:function(b,c,d){e.emit(b,c,function(){var b=arguments;a.$apply(function(){d&&d.apply(e,b)})})}}}]),angular.module("zTurnosClienteApp").service("SocketManager",["$rootScope","Socket","growl","$location","$timeout",function(a,b,c,d,e){function f(b){var c={cola_id:b.cola_id,current:b.current,from:b.from,hora:new Date,prefijo:b.prefijo,"class":"lastchange"};a.history.push(c),i(c,a.perfilApp.alertIterations)}var g=function(a){return function(){a.class=void 0!=a.class?void 0:"lastchange"}},h=function(a){return function(){a.class=void 0}},i=function(b,c){for(var d=0;c>d;d++)e(g(b),a.perfilApp.intervalTime*d);e(h(b),a.perfilApp.intervalTime*c)};b.on("status",function(b){a.colas={},_.each(b,function(b){a.colas[b.cola_id]=b,f(b)})}),b.on("refresh",function(b){console.log("Reprodusco a: "+a.perfilApp.sound1.volume),a.perfilApp.sound1.play(),a.colas[b.cola_id].current=b.current,a.colas[b.cola_id].from=b.from,a.ultima_cola_movida=b.cola_id,f(b)});var j=function(){b.emit("status")};return{requestStatus:j}}]),angular.module("zTurnosClienteApp").controller("IndexCtrl",["$rootScope","$scope","SocketManager","$sce","ListaPautas","localStorageService",function(a,b,c,d,e,f){c.requestStatus(),e.query({},function(c){b.pautas=c;var e=[];_.each(b.pautas,function(a){var b=a.path.split("."),c=b[b.length-1];e.push({pauta:a,sources:[{src:d.trustAsResourceUrl(a.lan_path),lan_source:a.lan_path,srcUrl:a.lan_path,type:"video/"+c},{src:d.trustAsResourceUrl(a.path),lan_source:a.path,srcUrl:a.path,type:"video/"+c}]})}),a.videoSources=e,a.saveVideos(e),b.loadVideoPosition(),b.videoConfig={preload:"auto",autoPlay:!0,sources:a.videosSources[b.currentVideo].sources,theme:{url:"extras/styles/videogular.css"}}},function(c){console.log(c),b.loadVideoPosition(),b.videoConfig={preload:"auto",autoPlay:!0,sources:a.videosSources[b.currentVideo].sources,theme:{url:"extras/styles/videogular.css"}}}),b.isLastChange=function(b){return b.cola_id==a.ultima_cola_movida},b.getFontSize=function(){return a.perfilApp.fontSize+"px"},b.videoWidth=a.perfilApp.videoWidth+"%",b.turnosWidth=100-a.perfilApp.videoWidth+"%",b.currentTime=0,b.totalTime=0,b.state=null,b.isCompleted=!1,b.API=null,b.onPlayerReady=function(c){b.API=c,b.API.setVolume(a.perfilApp.volumenVideo),("play"==b.state||b.isCompleted)&&b.API.play(),b.isCompleted=!1},b.onCompleteVideo=function(){b.isCompleted=!0;var c=a.videosSources[b.currentVideo];b.currentVideo++,b.currentVideo>=a.videosSources.length&&(b.currentVideo=0),console.log("Pauta: "+b.currentVideo+" reproducida..."),b.setVideo(b.currentVideo),b.saveVideoPosition(),e.loguearPautaReproducida({pauta_reproducida:c.pauta},function(){console.log("Pauta logueada!")},function(a){console.log(a)})},b.saveVideoPosition=function(){f.set("$scope.currentVideo",b.currentVideo)},b.loadVideoPosition=function(){b.currentVideo=f.get("$scope.currentVideo"),void 0==b.currentVideo&&(b.currentVideo=0,b.saveVideoPosition())},b.onUpdateState=function(a){b.state=a},b.setVideo=function(c){b.currentVideo=c,b.videoConfig.sources=a.videosSources[c].sources}}]),angular.module("zTurnosClienteApp").controller("ConfiguracionCtrl",["SocketManager","$scope","$rootScope","$sce","localStorageService","growl","$window",function(a,b,c,d,e,f,g){b.showVideoOn=function(){c.perfilApp.showVideo=!0},b.showVideoOff=function(){c.perfilApp.showVideo=!1},b.savePerfil=function(){c.savePerfilApp(),f.addSuccessMessage("Perfil guardado con exito.")},b.modoPantallaRef="mostrar",b.modoNameSpace="mostrar",b.modoHost="mostrar",b.modoPort="mostrar",b.modoNombreNodo="mostrar",b.modoPuestoVenta="mostrar",b.modoTipoPuesto="mostrar",b.toggleMode=function(a){b[a]="mostrar"==b[a]?"editar":"mostrar"},b.reload=function(){g.location.href="/"},b.changeTheme=function(a){c.perfilApp.theme=a,c.$broadcast("changeTheme")},c.$watch("perfilApp.volumenAlerta",function(a){c.configureSound(a)})}]),angular.module("zTurnosClienteApp").filter("reverse",function(){return function(a){return a.slice().reverse()}}),angular.module("zTurnosClienteApp").filter("getLastN",["$rootScope",function(){return function(a,b){return a.splice(0,b)}}]),angular.module("zTurnosClienteApp").controller("BodyCtrl",["$scope","$rootScope",function(a,b){a.bodyClass=b.perfilApp.theme,b.$on("changeTheme",function(){console.log("cambie tema"),a.bodyClass=b.perfilApp.theme})}]),angular.module("zTurnosClienteApp").factory("ListaPautas",["$resource","$rootScope",function(a,b){return a("/api/listaPautas",{nombre_nodo:function(){return b.perfilApp.nombre_nodo},tipo_puesto:function(){return b.perfilApp.tipo_puesto},puesto_venta:function(){return b.perfilApp.puesto_venta}},{query:{method:"GET",isArray:!0},loguearPautaReproducida:{method:"POST",isArray:!1,url:"/api/log_pauta_reproducida"}})}]);